FROM golang:latest

RUN go get github.com/apex/log
RUN go get github.com/brocaar/lorawan
RUN go get github.com/jacobsa/crypto/cmac

RUN mkdir -p /go/src/github.com/TheThingsNetwork/ttn
ADD . /go/src/github.com/TheThingsNetwork/ttn

ENV UDP_PORT=33000
ENV TCP_PORT=4000

EXPOSE 33000/udp
EXPOSE 4000/tcp

RUN go build github.com/TheThingsNetwork/ttn/integration/router
CMD ./router --brokers $BROKERS --udp-port $UDP_PORT --tcp-port $TCP_PORT
